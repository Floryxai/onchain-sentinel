<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>On-Chain Sentinel - Trending Memecoins</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0e1a;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function TrendingTracker() {
            const [tokens, setTokens] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [lastUpdate, setLastUpdate] = useState(null);
            const [autoRefresh, setAutoRefresh] = useState(true);

            const calculateRisk = (token) => {
                let riskScore = 0;
                let factors = [];

                // Low liquidity = high risk
                if (token.liquidity < 10000) {
                    riskScore += 40;
                    factors.push('Very low liquidity');
                } else if (token.liquidity < 50000) {
                    riskScore += 25;
                    factors.push('Low liquidity');
                }

                // High volatility = high risk
                if (Math.abs(token.priceChange1h) > 30) {
                    riskScore += 20;
                    factors.push('Extreme volatility');
                } else if (Math.abs(token.priceChange1h) > 15) {
                    riskScore += 10;
                    factors.push('High volatility');
                }

                // Volume/liquidity ratio
                const volLiqRatio = token.volume24h / token.liquidity;
                if (volLiqRatio > 5) {
                    riskScore += 15;
                    factors.push('Volume spike vs liquidity');
                }

                // Recent dump
                if (token.priceChange1h < -20) {
                    riskScore += 20;
                    factors.push('Recent dump');
                }

                let risk = 'LOW';
                let color = 'text-green-400';
                if (riskScore > 60) {
                    risk = 'EXTREME';
                    color = 'text-red-500';
                } else if (riskScore > 40) {
                    risk = 'HIGH';
                    color = 'text-orange-500';
                } else if (riskScore > 20) {
                    risk = 'MEDIUM';
                    color = 'text-yellow-500';
                }

                return { risk, color, factors, score: riskScore };
            };

            const fetchTrending = async () => {
                try {
                    setLoading(true);
                    setError(null);
                    
                    // Fetch trending Solana tokens
                    const response = await fetch('https://api.allorigins.win/raw?url=' + encodeURIComponent('https://api.dexscreener.com/latest/dex/search?q=solana'));
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.pairs) {
                        // Filter for Solana pairs with significant volume, exclude wrapped SOL
                        const trending = data.pairs
                            .filter(p => 
                                p.chainId === 'solana' && 
                                p.volume?.h24 > 10000 &&
                                p.liquidity?.usd > 5000 &&
                                p.baseToken.symbol !== 'SOL' &&
                                p.baseToken.symbol !== 'WSOL' &&
                                p.baseToken.address !== 'So11111111111111111111111111111111111111112'
                            )
                            .map(p => ({
                                address: p.baseToken.address,
                                symbol: p.baseToken.symbol,
                                name: p.baseToken.name,
                                price: parseFloat(p.priceUsd || 0),
                                priceChange5m: parseFloat(p.priceChange?.m5 || 0),
                                priceChange1h: parseFloat(p.priceChange?.h1 || 0),
                                priceChange6h: parseFloat(p.priceChange?.h6 || 0),
                                priceChange24h: parseFloat(p.priceChange?.h24 || 0),
                                volume24h: parseFloat(p.volume?.h24 || 0),
                                liquidity: parseFloat(p.liquidity?.usd || 0),
                                marketCap: parseFloat(p.fdv || 0),
                                txns24h: (p.txns?.h24?.buys || 0) + (p.txns?.h24?.sells || 0),
                                buys24h: p.txns?.h24?.buys || 0,
                                sells24h: p.txns?.h24?.sells || 0,
                            }))
                            // Sort by 24h volume (trending)
                            .sort((a, b) => b.volume24h - a.volume24h)
                            .slice(0, 30);
                        
                        setTokens(trending);
                        setLastUpdate(new Date());
                    }
                    
                    setLoading(false);
                } catch (err) {
                    setError('Failed to fetch trending tokens. Using demo data...');
                    setLoading(false);
                    
                    // Demo data for testing
                    const demoTokens = [
                        { symbol: 'BRAINROT', name: 'brainrot', price: 0.00012, priceChange24h: 274.5, priceChange1h: 20.08, volume24h: 86000, liquidity: 40400, marketCap: 163000, txns24h: 896, buys24h: 461, sells24h: 435, address: 'demo1' },
                        { symbol: 'BAGLESS', name: 'Bagless', price: 0.0034, priceChange24h: 189.6, priceChange1h: -18.97, volume24h: 61400, liquidity: 176000, marketCap: 171000, txns24h: 758, buys24h: 416, sells24h: 342, address: 'demo2' },
                        { symbol: 'CREATOR', name: 'Creator Coin', price: 0.0089, priceChange24h: 100.9, priceChange1h: -19.35, volume24h: 39000, liquidity: 179000, marketCap: 177000, txns24h: 561, buys24h: 353, sells24h: 208, address: 'demo3' },
                    ];
                    setTokens(demoTokens);
                    setLastUpdate(new Date());
                }
            };

            useEffect(() => {
                fetchTrending();
                if (autoRefresh) {
                    const interval = setInterval(fetchTrending, 60000); // Every 60 seconds
                    return () => clearInterval(interval);
                }
            }, [autoRefresh]);

            const formatNumber = (num) => {
                if (num >= 1000000) return `$${(num / 1000000).toFixed(2)}M`;
                if (num >= 1000) return `$${(num / 1000).toFixed(1)}K`;
                return `$${num.toFixed(4)}`;
            };

            const formatPercent = (val) => {
                return `${val > 0 ? '+' : ''}${val.toFixed(2)}%`;
            };

            return (
                <div className="min-h-screen bg-[#0a0e1a] text-white p-4">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="mb-6">
                            <div className="flex items-center justify-between mb-2">
                                <div>
                                    <h1 className="text-2xl font-bold text-white mb-1">üî• TRENDING NOW</h1>
                                    <p className="text-gray-500 text-sm">Top Solana memecoins by 24h volume</p>
                                </div>
                                <div className="flex gap-3 items-center">
                                    <button
                                        onClick={() => setAutoRefresh(!autoRefresh)}
                                        className={`px-4 py-2 rounded text-sm ${autoRefresh ? 'bg-green-600' : 'bg-gray-700'}`}
                                    >
                                        {autoRefresh ? '‚ö° Live' : '‚è∏ Paused'}
                                    </button>
                                    <button
                                        onClick={fetchTrending}
                                        disabled={loading}
                                        className="px-4 py-2 bg-blue-600 rounded text-sm hover:bg-blue-700"
                                    >
                                        {loading ? '...' : 'üîÑ Refresh'}
                                    </button>
                                </div>
                            </div>
                            {lastUpdate && (
                                <p className="text-xs text-gray-600">
                                    Last updated: {lastUpdate.toLocaleTimeString()}
                                </p>
                            )}
                        </div>

                        {error && (
                            <div className="mb-4 p-3 bg-yellow-900/20 border border-yellow-700 rounded text-yellow-400 text-sm">
                                ‚ö†Ô∏è {error}
                            </div>
                        )}

                        {/* Token List */}
                        <div className="space-y-2">
                            {tokens.map((token, idx) => {
                                const riskData = calculateRisk(token);
                                const buyPressure = token.buys24h / (token.buys24h + token.sells24h) * 100;
                                
                                return (
                                    <div
                                        key={token.address}
                                        className="bg-[#141921] border border-gray-800 rounded-lg p-4 hover:border-gray-700 transition-all"
                                    >
                                        <div className="flex items-center justify-between">
                                            {/* Token Info */}
                                            <div className="flex items-center gap-4 flex-1">
                                                <div className="text-gray-500 text-sm w-6">#{idx + 1}</div>
                                                <div className="min-w-[120px]">
                                                    <div className="font-bold text-white">{token.symbol}</div>
                                                    <div className="text-xs text-gray-500">{token.name}</div>
                                                </div>
                                            </div>

                                            {/* Market Cap */}
                                            <div className="min-w-[100px]">
                                                <div className="text-gray-500 text-xs">Market Cap</div>
                                                <div className="text-white font-medium">{formatNumber(token.marketCap)}</div>
                                            </div>

                                            {/* Liquidity */}
                                            <div className="min-w-[100px]">
                                                <div className="text-gray-500 text-xs">Liquidity</div>
                                                <div className="text-white">{formatNumber(token.liquidity)}</div>
                                            </div>

                                            {/* Volume */}
                                            <div className="min-w-[100px]">
                                                <div className="text-gray-500 text-xs">Volume 24h</div>
                                                <div className="text-white">{formatNumber(token.volume24h)}</div>
                                            </div>

                                            {/* Transactions */}
                                            <div className="min-w-[100px]">
                                                <div className="text-gray-500 text-xs">Txns 24h</div>
                                                <div className="flex gap-2 text-sm">
                                                    <span className="text-green-400">{token.buys24h}</span>
                                                    <span className="text-gray-600">/</span>
                                                    <span className="text-red-400">{token.sells24h}</span>
                                                </div>
                                            </div>

                                            {/* Price Changes */}
                                            <div className="min-w-[140px]">
                                                <div className="flex gap-2">
                                                    <div>
                                                        <div className="text-gray-500 text-xs">1h</div>
                                                        <div className={`text-sm font-medium ${token.priceChange1h >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                            {formatPercent(token.priceChange1h)}
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div className="text-gray-500 text-xs">24h</div>
                                                        <div className={`text-sm font-medium ${token.priceChange24h >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                            {formatPercent(token.priceChange24h)}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Risk Rating */}
                                            <div className="min-w-[120px]">
                                                <div className="text-gray-500 text-xs mb-1">Risk Level</div>
                                                <div className={`font-bold ${riskData.color}`}>
                                                    {riskData.risk}
                                                </div>
                                                {riskData.factors.length > 0 && (
                                                    <div className="text-xs text-gray-600 mt-1">
                                                        {riskData.factors[0]}
                                                    </div>
                                                )}
                                            </div>

                                            {/* Action Button */}
                                            <button className="px-4 py-2 bg-blue-600 rounded text-sm hover:bg-blue-700 transition-colors">
                                                View
                                            </button>
                                        </div>

                                        {/* Buy Pressure Bar */}
                                        <div className="mt-3 flex items-center gap-2">
                                            <div className="flex-1 h-1 bg-gray-800 rounded-full overflow-hidden">
                                                <div 
                                                    className="h-full bg-green-500"
                                                    style={{ width: `${buyPressure}%` }}
                                                />
                                            </div>
                                            <div className="text-xs text-gray-500 w-16 text-right">
                                                {buyPressure.toFixed(0)}% buys
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        {tokens.length === 0 && !loading && (
                            <div className="text-center py-12 text-gray-500">
                                <p className="text-2xl mb-2">üëÄ</p>
                                <p>No trending tokens found</p>
                                <p className="text-sm mt-2">Click refresh to scan for trending memecoins</p>
                            </div>
                        )}

                        {/* Footer */}
                        <div className="mt-8 pt-4 border-t border-gray-800 text-center text-xs text-gray-600">
                            <p>Risk ratings based on liquidity, volatility, and volume analysis</p>
                            <p className="mt-1">‚ö†Ô∏è Not financial advice. DYOR before trading.</p>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TrendingTracker />);
    </script>
</body>
</html>
